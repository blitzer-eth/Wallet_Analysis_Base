WITH input_wallet AS (
  SELECT FROM_HEX(SUBSTRING('{{wallet address:}}', 3)) AS address
),

txns AS (
  SELECT
    DATE_TRUNC('day', block_time) AS day,
    gas_used * gas_price / 1e18 AS gas_eth
  FROM base.transactions
  JOIN input_wallet ON transactions."from" = input_wallet.address
),

daily_gas AS (
  SELECT
    day,
    SUM(gas_eth) AS daily_gas_eth
  FROM txns
  GROUP BY day
),

cumulative_gas AS (
  SELECT
    day,
    daily_gas_eth,
    SUM(daily_gas_eth) OVER (ORDER BY day) AS cumulative_gas_eth
  FROM daily_gas
)

SELECT
  day,
  CAST(daily_gas_eth AS DECIMAL(10,5)) AS daily_gas_eth,
  CAST(cumulative_gas_eth AS DECIMAL(10,5)) AS cumulative_gas_eth
FROM cumulative_gas
ORDER BY day;
